!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=15)}([function(t,e,i){"use strict";function s(t,i){return Object.keys(e.defaultFormatting).every(s=>(t[s]||e.defaultFormatting[s])===(i[s]||e.defaultFormatting[s]))}function n(t){const i={text:t.text};return Object.keys(e.defaultFormatting).forEach(s=>{const n=t[s];n&&n!==e.defaultFormatting[s]&&(i[s]=n)}),i}function r(t){return"string"==typeof t?t.length:1}function o(t){return"string"==typeof t?t:"_"}function*l(t,e,i){if(0!==i)if("string"!=typeof t)if(Array.isArray(t)){let s=0;for(const n of t){if(i<=0)break;const t=r(n);if(s+t>e)if("string"==typeof n){const t=n.substr(Math.max(0,e-s),i);yield t,i-=t.length}else yield n,i-=1;s+=t}}else yield t;else yield t.substr(e,i)}Object.defineProperty(e,"__esModule",{value:!0}),e.getTextChar=e.getSubText=e.getTextLength=e.getPiecePlainText=e.getPieceLength=e.getPlainText=e.consolidate=e.format=e.merge=e.cloneWith=e.clone=e.sameFormatting=e.isMultipleValues=e.multipleValues=e.defaultFormatting=void 0,e.defaultFormatting={size:16,font:"Arial, sans-serif",color:"black",bgcolor:"transparent",bold:!1,italic:!1,underline:!1,strikeout:!1,align:"left",script:"normal",url:""},e.multipleValues={},e.isMultipleValues=function(t){return t==e.multipleValues},e.sameFormatting=s,e.clone=n,e.cloneWith=function(t,i){const s={text:i};return Object.keys(e.defaultFormatting).forEach(i=>{const n=t[i];n&&n!==e.defaultFormatting[i]&&n!==e.multipleValues&&(s[i]=n)}),s},e.merge=function(t,i){const s={};return Object.keys(e.defaultFormatting).forEach(n=>{const r=t[n]||e.defaultFormatting[n],o=i[n]||e.defaultFormatting[n];s[n]=r===o?r:e.multipleValues}),s.url=t.url||i.url,s},e.format=function t(i,s){Array.isArray(i)?i.forEach(e=>{t(e,s)}):Object.keys(s).forEach(t=>{s[t]!==e.multipleValues&&(i[t]=s[t])})},e.consolidate=function*(t){let e;for(const i of t)e&&s(e,i)&&"string"==typeof e.text&&"string"==typeof i.text?e.text+=i.text:(e=n(i),yield e)},e.getPlainText=function(t){if("string"==typeof t.text)return t.text;if(Array.isArray(t.text)){const e=[];return t.text.forEach(t=>{e.push(o(t))}),e.join("")}return"_"},e.getPieceLength=r,e.getPiecePlainText=o,e.getTextLength=function(t){if("string"==typeof t)return t.length;if(Array.isArray(t)){let e=0;return t.forEach(t=>{e+=r(t)}),e}return 1},e.getSubText=l,e.getTextChar=function(t,e){return l(t,e,1).next().value}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e,i,s){this.l=t,this.t=e,this.w=i,this.h=s,this.r=t+i,this.b=e+s}contains(t,e){return t>=this.l&&t<this.r&&e>=this.t&&e<this.b}stroke(t){t.strokeRect(this.l,this.t,this.w,this.h)}fill(t){t.fillRect(this.l,this.t,this.w,this.h)}offset(t,e){return new s(this.l+t,this.t+e,this.w,this.h)}equals(t){return this.l===t.l&&this.t===t.t&&this.w===t.w&&this.h===t.h}center(){return{x:this.l+this.w/2,y:this.t+this.h/2}}}e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.draw=e.newLineWidth=e.nbsp=e.measure=e.cache=e.measureText=e.Measure=e.getRunStyle=e.prepareContext=e.applyRunStyle=e.applyRunBackgroundStyle=e.getFontString=e.hyperlinkColor=e.unfocusedSelectionColor=e.selectionColor=void 0;const s=i(0),n=i(0);function r(t){let e=t&&t.size||s.defaultFormatting.size;if(t)switch(t.script){case"super":case"sub":e*=.7}return(t&&t.italic?"italic ":"")+(t&&t.bold?"bold ":"")+" "+e+"px "+(t&&t.font||s.defaultFormatting.font)}function o(t,e){t.fillStyle=e&&e.bgcolor||s.defaultFormatting.bgcolor}function l(t,e){t.fillStyle=e&&e.color||s.defaultFormatting.color,t.strokeStyle=e&&e.color||s.defaultFormatting.color,t.font=r(e)}function h(t){t.textAlign="left",t.textBaseline="alphabetic"}function a(t){return["font: ",r(t),"; color: ",t&&t.color||s.defaultFormatting.color].join("")}e.selectionColor="rgba(0, 168, 213, 0.12)",e.unfocusedSelectionColor="#A0A0A077",e.hyperlinkColor="#1565C0",e.getFontString=r,e.applyRunBackgroundStyle=o,e.applyRunStyle=l,e.prepareContext=h,e.getRunStyle=a;class c{constructor(t,e,i){this.width=t,this.ascent=e,this.descent=i,this.height=e+i}}function d(t,e){const i=document.createElement("canvas").getContext("2d");i.font=r(e);const s=i.measureText(t),o=1.2*(e.size||n.defaultFormatting.size);return new c(s.width,Math.round(o*(3/4)),Math.round(o/4))}function u(t,i){const s=a(i)+"<>!&%"+t;let n=e.cache.get(s);return n||(n=d(t,i),e.cache.set(s,n)),n}e.Measure=c,e.measureText=d,e.cache=new Map,e.measure=u,e.nbsp=String.fromCharCode(160),e.newLineWidth=u(e.nbsp,n.defaultFormatting).width,e.draw=function(t,i,s,n,r,a,c,d){switch(h(t),s.script){case"super":r-=.4*c;break;case"sub":r+=d*(2/3)}s.bgcolor&&(o(t,s),t.fillRect(n,r-c,a,c+d)),l(t,s),t.fillText("\n"===i?e.nbsp:i,n,r),s.underline&&t.fillRect(n,1+r,a,1),s.strikeout&&t.fillRect(n,1+r-c/2,a,1)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1);e.default=class{constructor(t){this.type=t}children(){return[]}parent(){return null}first(){return this.children()[0]}last(){return this.children()[this.children().length-1]}next(){const t=this.parent();if(!t)return null;const e=t.children();let i=e[e.indexOf(this)+1];if(i){for(;;){const t=i.first();if(!t)break;i=t}return i}return t.next()}previous(){const t=this.parent();if(!t)return null;const e=t.children(),i=e[e.indexOf(this)-1];if(i)return i;const s=t.previous();return s?s.last():null}byOrdinal(t){for(const e of this.children())if(t>=e.ordinal&&t<e.ordinal+e.length){const i=e.byOrdinal(t);if(i)return i}return this}byCoordinate(t,e){if(0==this.children().length)return this;for(const i of this.children()){if(i.bounds().contains(t,e)){const s=i.byCoordinate(t,e);if(s)return s}}let i=this.last();for(;i;){const t=i.last();if(!t)break;i=t}const s=i.next();return!i.newLine&&s&&s.block&&(i=s),i}draw(t,e){this.children().forEach(i=>{i.draw(t,e)})}parentOfType(t){const e=this.parent();return e&&(e.type===t?e:e.parentOfType(t))}bounds(t){let e=this._left,i=this._top,n=0,r=0;return this.children().forEach(t=>{const s=t.bounds();e=Math.min(e,s.l),i=Math.min(i,s.t),n=Math.max(n,s.l+s.w),r=Math.max(r,s.t+s.h)}),new s.default(e,i,n-e,r-i)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.editFilter=e.customCodes=void 0;const s=i(2),n=i(1),r=i(0),o=i(2),l=i(8),h=i(20),a=i(21),c=(t,e)=>({eof:!0,name:t,type:e,measure:t=>s.measure(s.nbsp,t)}),d=(t,e)=>({measure:i=>{const n=e(i),r=s.measure(s.nbsp,n),l=s.measure(t,n);return new o.Measure(l.width,Math.max(r.ascent,l.ascent),Math.max(r.descent,l.descent))},draw:(i,n,r,o,l,h,a)=>{const c=e(a);s.draw(i,t,c,n,r,o,l,h)},name:"marker"}),u=(new Map).set("number",t=>d(t+1+".",t=>({font:t.font,size:t.size,color:t.color,bold:t.bold,italic:t.italic}))).set("bullet",()=>d("â€¢",t=>({size:t.size,color:t.color}))),f=(new Map).set("listNext",c).set("listEnd",c).set("listStart",(t,e)=>({name:t,type:e=e||"number",block:(t,i,s,r,o,c)=>{const d=new a.default("list",o,t,i);let f=40;let g=c,p=[];const w=()=>{const o=new a.default("item",d),c=u.get(e)(d.children().length);let w=new h.default(c,o,r,1,g);w.block=!0,f=Math.max(f,w.measured.width+10);const m=new l.default(p,t+f,i,s-f,r+1,o,w.measured.ascent,w.measured.descent);r=m.ordinal+m.length;const y=m.bounds(),b=m.first(),x=t+f-10-w.measured.width,v=new n.default(t,i,f,y.h);"baseline"in b?w.position(x,b.baseline,v):w.position(x,i+w.measured.ascent,v),i=y.t+y.h,o.children().push(w),o.children().push(m),o.finalize(),d.children().push(o),w=null};return function(t){p.push(t);const i=t.code();if(i){if("listEnd"===i.name)return w(),d.finalize(),d;"listNext"===i.name&&(i.type=e,p.pop(),w(),p=[],g=t.startFormatting())}}}}));e.default=function(t,i){const s=e.customCodes&&e.customCodes(t,i);if(s)return s;const n=f.get(t.$);return n&&n(t.$,t.marker)};const g=t=>t&&t.code()&&t.code().name,p=t=>"listEnd"==g(t)||t.isNewLine();e.editFilter=function(t){const e=function(t){let e=0;for(const i of t){const t=i.code();if(t)switch(t.name){case"listStart":e++;break;case"listEnd":if(e<=0)return!1;e--}}return 0==e}(t.words);let i=!1;for(let s=0;s<t.words.length;s++){const n=t.words[s];if(n.isNewLine()&&i){if("listNext"==g(t.words[s-1])&&"listEnd"==g(t.words[s+1])){const e=[{text:{$:"listEnd"}},{text:"\n"}];t.spliceWordsWithRuns(s-1,3,e,!1);const i=t.wordOrdinal(s);return setTimeout(()=>{t.select(i,i,!0)}),!0}const i={$:e?"listNext":"listEnd"};return t.spliceWordsWithRuns(s,1,[{text:i}],!1),!0}const r=n.code();if(r)switch(r.name){case"listStart":if(i)return t.spliceWordsWithRuns(s,1,[{text:{$:"listNext"}}],!1),!0;i=!0;break;case"listNext":if(!i){const e={text:{$:"listStart",marker:r.type}};return t.spliceWordsWithRuns(s,1,[e],!1),!0}break;case"listEnd":if(!i)return t.spliceWordsWithRuns(s,1,[{text:"\n"}],!1),!0;i=!1}}for(let e=1;e<t.words.length;e++)if(!p(t.words[e-1])&&"listStart"==g(t.words[e]))return t.spliceWordsWithRuns(e,0,[{text:"\n"}],!1),!0;const s=t.words.length;if(i)return t.spliceWordsWithRuns(s,0,[{text:{$:"listEnd"}}],!1),!0;if(0==s||!p(t.words[s-1]))return t.spliceWordsWithRuns(s,0,[{text:"\n"}],!1),!0;for(let e=0;e<t.words.length;e++){const i=t.words[e],s=g(i);let n,o;if("listStart"===s||"listNext"===s)if(e<t.words.length-1&&!g(t.words[e+1]))n=t.words[e+1].startFormatting();else{if(!(e>0))continue;n=t.words[e-1].endFormatting()}else{if("listEnd"!==s&&!i.isNewLine())continue;if(!(e>0))continue;n=t.words[e-1].endFormatting()}if(o=s?i.code().type?{$:s,marker:i.code().type}:{$:s}:"\n",n=n||r.defaultFormatting,!r.sameFormatting(i.startFormatting(),n))return t.spliceWordsWithRuns(e,1,[r.cloneWith(n,o)],!1),!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.create=void 0;const s=i(6),n=i(1),r=i(9);e.create=function(t){t.innerHTML='<canvas width="100" height="100" class="murokEditorCanvas" style="position: absolute;"></canvas><div class="murokTextArea" style="overflow: hidden; position: absolute; height: 0; top: 0"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0; width: 1000px; height: 1em; outline: none; font-size: 4px;"></textarea></div>',t.style.overflow="hidden";const e=t.querySelector("canvas"),i=t.querySelector("textarea"),o=new s.default;let l,h=0,a=null,c=null,d=null,u=null,f="",g=null;const p=(new Map).set(66,"bold").set(73,"italic").set(85,"underline").set(83,"strikeout"),w=(t,e)=>e<0?t<=0:t>=o.frame.length-1,m=(t,e)=>t.b<=e.t||e.b<=t.t,y=(t,e)=>{let i,s=o.getCaretCoords(t);for(c=null!==a?a:s.l;!w(t,e)&&(t+=e,i=o.getCaretCoords(t),!m(i,s)););for(s=i;!w(t,e)&&!(e>0&&i.l>=c||e<0&&i.l<=c);)if(t+=e,i=o.getCaretCoords(t),m(i,s)){t-=e;break}return t},b=(t,e)=>{const i=o.getCaretCoords(t);let s;for(;!w(t,e);)if(t+=e,s=o.getCaretCoords(t),m(s,i)){t-=e;break}return t};i.addEventListener("keydown",t=>{((t,e,i)=>{let s=o.selection.start,n=o.selection.end;const r=o.frame.length-1;let d=!1;if(c=null,e){if(!h)switch(t){case 37:case 38:case 36:case 33:h=-1;break;case 39:case 40:case 35:case 34:h=1}}else h=0;let f=1===h?n:s,w=!1;switch(t){case 37:if(e||s===n){if(f>0)if(i){const t=o.wordContainingOrdinal(f);f=t.ordinal===f?t.index>0?o.wordOrdinal(t.index-1):0:t.ordinal}else f--}else f=s;w=!0;break;case 39:if(e||s===n){if(f<r)if(i){const t=o.wordContainingOrdinal(f);f=t.ordinal+t.word.length}else f++}else f=n;w=!0;break;case 40:f=y(f,1),w=!0;break;case 38:f=y(f,-1),w=!0;break;case 36:f=b(f,-1),w=!0;break;case 35:f=b(f,1),w=!0;break;case 33:f=0,w=!0;break;case 34:f=r,w=!0;break;case 8:s===n&&s>0&&(o.range(s-1,s).clear(),u=s-1,o.select(u,u),d=!0);break;case 46:s===n&&s<r&&(o.range(s,s+1).clear(),d=!0);break;case 90:i&&(d=!0,o.performUndo());break;case 89:i&&(d=!0,o.performUndo(!0));break;case 65:i&&(d=!0,o.select(0,r));break;case 67:case 88:i&&(l=o.selectedRange().save(),g=o.selectedRange().plainText())}const m=p.get(t);if(i&&m){const t=o.selectedRange();t.setFormatting(m,!0!==t.getFormatting()[m]),x(),d=!0}if(w){switch(h){case 0:s=n=f;break;case-1:s=f;break;case 1:n=f}if(s===n)h=0;else if(s>n){h=-h;const t=n;n=s,s=t}u=f,o.select(s,n),d=!0}return a=c,d})(t.keyCode,t.shiftKey,t.ctrlKey)&&t.preventDefault()});const x=()=>{const s=t.clientWidth;o.width()!==s&&o.setWidth(s);const r=Math.max(1,window.devicePixelRatio||1),l=Math.max(o.frame.actualWidth(),t.clientWidth),h=t.clientHeight;e.width=r*l,e.height=r*h,e.style.width=l+"px",e.style.height=h+"px";const a=e.getContext("2d");a.scale(r,r),o.draw(a,new n.default(0,0,l,h)),o.drawSelection(a,!!d||document.activeElement===i)};i.addEventListener("input",()=>{const t=i.value;f!==t&&(f="",i.value="",t===g?o.insert(l):o.insert(t))});const v=()=>{u=null===u?o.selection.end:u;const e=o.byOrdinal(u);if(u=null,e){const s=e.bounds();i.focus();const n=Math.max(0,s.t+s.h-(t.scrollTop+t.clientHeight));n&&(t.scrollTop+=n);const r=Math.max(0,t.scrollTop-s.t);r&&(t.scrollTop-=r);const o=Math.max(0,s.l-(t.scrollLeft+t.clientWidth));o&&(t.scrollLeft+=o);const l=Math.max(0,t.scrollLeft-s.l);l&&(t.scrollLeft-=l)}f=o.selectedRange().plainText(),i.value=f,i.select(),setTimeout(()=>{i.focus()},10)};o.selectionChanged((t,e)=>{x(),d||!1!==e&&v()});const E=(t,i)=>{e.addEventListener(t,t=>{i(o.byCoordinate(t.offsetX,t.offsetY)),t.preventDefault(),t.stopPropagation()})};let _,H=!1;E("pointerdown",t=>{if(H)return(t=t.parent())&&o.select(t.ordinal,t.ordinal+(t instanceof r.PositionedWord?t.word.text.length:t.length)),void(H=!1);H=!0,clearTimeout(_),_=setTimeout(()=>H=!1,200),d=t.ordinal,o.select(t.ordinal,t.ordinal),a=null}),E("pointermove",t=>{null!==d&&t&&(u=t.ordinal,d>t.ordinal?o.select(t.ordinal,d):o.select(d,t.ordinal))}),E("pointerup",()=>{d=null,a=null,v(),i.focus()});let C=(new Date).getTime(),L=!1,W=t.clientWidth,R=t.clientHeight;const S=()=>{let e=!1;const s=document.activeElement===i;L!==s&&(L=s,e=!0);const n=(new Date).getTime();n>C&&(C=n+500,o.toggleCaret()&&(e=!0)),t.clientWidth===W&&t.clientHeight===R||(e=!0,W=t.clientWidth,R=t.clientHeight),e&&x()};return S(),setInterval(S,200),o}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(16),n=i(17),r=i(3),o=i(0),l=i(22),h=i(14),a=i(8),c=i(4),d=i(1),u=i(0),f=i(2),g=i(10),p=(t,e,i,s)=>{const n=t.selection.start,r=t.selection.end;return o=>{t._wordOrdinals=[];const l=t.words.splice(e,i,...s);o(p(t,e,s.length,l)),t._nextSelection={start:n,end:r}}},w=t=>{const e=[];return t(t=>{e.push(t)}),t=>{t(w(t=>{for(;e.length;)e.pop()(t)}))}},m=t=>{if(t.isNewLine())return!0;const e=t.code();return!(!e||!e.block&&!e.eof)},y=t=>[...n.split(s.characters([{text:t}]))],b=t=>t&&t.code()&&t.code().name;class x extends r.default{constructor(){super("document"),this._width=0,this.selection={start:0,end:0},this.caretVisible=!0,this.selectionChanged=h.default(),this.contentChanged=h.default(),this.load([])}load(t,e){for(this.undo=[],this.redo=[],this._wordOrdinals=[],this.words=[],this.words=[...n.split(s.characters(t))];c.editFilter(this););this.layout(),this.contentChanged.fire(),this.select(0,0,e)}layout(){this.frame=null;try{this.frame=new a.default(this.words,0,0,this._width,0,this)}catch(t){console.error(t)}if(this.frame){if(this._nextSelection){const t=this._nextSelection;delete this._nextSelection,this.select(t.start,t.end,!1)}}else console.error("A bug somewhere has produced an invalid state - rolling back"),this.performUndo()}range(t,e){return new l.Range(this,t,e)}documentRange(){return this.range(0,this.frame.length)}selectedRange(){return this.range(this.selection.start,this.selection.end)}save(){return this.documentRange().save()}paragraphRange(t,e){const i=this.wordContainingOrdinal(t);if(t=0,i&&!m(i.word))for(let e=i.index;e>0;e--)if(m(this.words[e-1])){t=this.wordOrdinal(e);break}const s=this.wordContainingOrdinal(e);if(e=this.frame.length-1,s&&!m(s.word))for(let t=s.index;t<this.words.length;t++)if(m(this.words[t])){e=this.wordOrdinal(t);break}return this.range(t,e)}hyperlinkRange(){let{start:t,end:e}=this.selection;for(;t>0&&this.range(t,t).getFormatting().url;)t--;for(;e<this.frame.length-1&&this.range(e+1,e+1).getFormatting().url;)e++;return this.range(t,e)}insert(t,e){this.select(this.selection.end+this.selectedRange().setText(t),null,e)}modifyInsertFormatting(t,e){this.nextInsertFormatting[t]=e,this.notifySelectionChanged(!1)}applyInsertFormatting(t){const e=this.nextInsertFormatting,i=Object.keys(e);i.length&&t.forEach(t=>{i.forEach(i=>{t[i]=e[i]})})}wordOrdinal(t){if(t<this.words.length){const e=this._wordOrdinals.length;if(e<t+1){let i=e>0?this._wordOrdinals[e-1]:0;for(let s=e;s<=t;s++)this._wordOrdinals[s]=i,i+=this.words[s].length}return this._wordOrdinals[t]}}wordContainingOrdinal(t){let e=0;for(let i=0;i<this.words.length;i++){const s=this.words[i];if(t>=e&&t<e+s.length)return{word:s,ordinal:e,index:i,offset:t-e};e+=s.length}if(t==this.frame.length){const t=this.words.length-1,i=this.words[t];return{word:i,ordinal:e-i.length,index:t,offset:i.length}}}*runs(t){const e=this.wordContainingOrdinal(Math.max(0,t.start)),i=this.wordContainingOrdinal(Math.min(t.end,this.frame.length));if(e.index===i.index)yield*e.word.runs({start:e.offset,end:i.offset});else{yield*e.word.runs({start:e.offset});for(let t=e.index+1;t<i.index;t++)yield*this.words[t].runs();yield*i.word.runs({end:i.offset})}}spliceWordsWithRuns(t,e,i,r=!0){this.spliceWords(t,e,[...n.split(s.characters(i))],r)}spliceWords(t,e,i,s=!0){this.transaction(n=>{if(p(this,t,e,i)(n),s&&!this._filtersRunning){for(this._filtersRunning=!0;c.editFilter(this););this._filtersRunning=!1}})}splice(t,e,i){let s;if("string"==typeof i){const n=Math.max(0,t-1),r=this.runs({start:n,end:n+1}).next().value;if(s=[r?o.cloneWith(r,i):{text:i}],r&&r.url){const i=this.runs({start:t,end:t+1}).next().value||u.defaultFormatting;(t==e&&0==t||i.url!=r.url)&&(delete s[0].url,delete s[0].color,delete s[0].underline)}}else s=Array.isArray(i)?i:[{text:i}];this.applyInsertFormatting(s);const n=this.wordContainingOrdinal(t),r=this.wordContainingOrdinal(e);let l,h;if(t===n.ordinal)if(n.index>0&&!m(this.words[n.index-1])){n.index--;l=[...this.words[n.index].runs()]}else l=[];else l=[...n.word.runs({end:n.offset})];e===r.ordinal?e===this.frame.length-1||m(r.word)?(h=[],r.index--):h=[...r.word.runs()]:h=[...r.word.runs({start:r.offset})];const a=[...o.consolidate(l.concat(s).concat(h))],c=a.reduce((t,e)=>t+o.getPieceLength(e.text),0),d=this.words.slice(n.index,r.index+1).reduce((t,e)=>t+e.length,0);return this.spliceWordsWithRuns(n.index,r.index-n.index+1,a),c-d}width(){return this._width}setWidth(t){this._width=t,this.layout()}children(){return[this.frame]}toggleCaret(){const t=this.caretVisible;return this.selection.start===this.selection.end&&(this.selectionJustChanged?this.selectionJustChanged=!1:this.caretVisible=!this.caretVisible),this.caretVisible!==t}getCaretCoords(t){const e=this.byOrdinal(t);if(e){if(t>0){const i=this.byOrdinal(t-1);if(i instanceof g.default&&i.word.word.softWrap||e.block){if(i instanceof g.default&&i.newLine){const t=i.bounds(),e=i.parent().parent().bounds();return new d.default(0,e.b,1,t.h)}{const t=i.bounds();return new d.default(t.r,t.t,1,t.h)}}}const i=e.bounds();return new d.default(i.l,i.t,1,i.h)}}byCoordinate(t,e){return this.frame.byCoordinate(t,e)}urlByCoordinate(t,e){const i=this.byCoordinate(t,e),s=this.range(i.ordinal,i.ordinal).getFormatting().url;if(i.bounds(!0).contains(t,e))return s;if(i instanceof g.default){const n=i.previous();if(n&&n.bounds(!0).contains(t,e))return s}}drawSelection(t,e){if(this.selection.end===this.selection.start){if(this.selectionJustChanged||e&&this.caretVisible){const e=this.getCaretCoords(this.selection.start);e&&(t.save(),t.fillStyle="black",e.fill(t),t.restore())}}else{t.save(),t.fillStyle=e?f.selectionColor:f.unfocusedSelectionColor;for(const e of this.selectedRange().parts())e.bounds(!0).fill(t);t.restore()}}notifySelectionChanged(t){let e=null;this.selectionChanged.fire(()=>(e||(e=this.selectedRange().getFormatting()),e),t)}select(t,e,i){this.frame&&(this.selection.start=Math.max(0,t),this.selection.end=Math.min("number"==typeof e?e:this.selection.start,this.frame.length-1),i&&(this.selectionJustChanged=!0),this.caretVisible=!0,this.nextInsertFormatting={},this.notifySelectionChanged(i))}performUndo(t){const e=t?this.redo:this.undo,i=t?this.undo:this.redo,s=e.pop();s&&(s(t=>{i.push(t)}),this.layout(),this.contentChanged.fire())}canUndo(t){return t?!!this.redo.length:!!this.undo.length}transaction(t){if(this._currentTransaction)t(this._currentTransaction);else{for(;this.undo.length>50;)this.undo.shift();this.redo.length=0,this.undo.push(w(e=>{this._currentTransaction=e;try{t(e)}finally{this._currentTransaction=null}})),this.layout(),this.contentChanged.fire()}}insertHyperlink(t,e){const i=this.selectedRange(),s=i.getFormatting(),n=(e?e.length:t.length)+i.start,r=this.hyperlinkRange();r.end>r.start&&this.select(r.start,r.end);const o=u.cloneWith(s,e||t);o.url=t,o.color=f.hyperlinkColor,o.underline=!0,this.selectedRange().setText([o]),this.select(n,n,!0)}setHyperlinkUrl(t){const e=this.hyperlinkRange();let i=e.getFormattingValue("color",f.hyperlinkColor);if(null==t)f.hyperlinkColor==i&&(i=null),this.updateLinkStyle(i,!1);else{const t=e.getFormattingValue("underline",!0);this.updateLinkStyle(i,t)}this.hyperlinkRange().setFormatting("url",t)}updateLinkStyle(t,e){this.hyperlinkRange().setFormatting("underline",e),this.hyperlinkRange().setFormatting("color",t)}switchListTo(t,e){const i=t.getListStyle();let s;s="number"==e?{$:"listStart"}:{$:"listStart",marker:e};const n=this.wordContainingOrdinal(t.start),r=this.wordContainingOrdinal(t.end);let o,l=n.index,h=r.index;for(;l>0&&!m(this.words[l-1]);)l--;for(l>0&&"listStart"!=b(this.words[l])&&l--;h<this.words.length-1&&!m(this.words[h]);)h++;o=i===e?this.removeList(l,h,s):i?this.switchListStyle(n.index,s):this.rebuildList(t,l,h,s),this.select(o.start,o.end)}removeList(t,e,i){let s=[],n=this.selection.start,r=this.selection.end;const o=this.words[t];if("listNext"==b(o))s=s.concat(y({$:"listEnd"}));else{const t=this.wordContainingOrdinal(n);t&&"listStart"!=b(t.word)&&n--,r--}for(let i=t+1;i<e;i++){const t=this.words[i];"listNext"==b(t)?s=s.concat(y("\n")):s.push(t)}return s=s.concat(y("\n")),"listNext"==b(this.words[e])&&(s=s.concat(y(i))),this.spliceWords(t,e-t+1,s),{start:n,end:r}}switchListStyle(t,e){for(let i=t;i>=0;i--){const t=this.words[i];if("listStart"==b(t))return this.spliceWordsWithRuns(i,1,[o.cloneWith(t.startFormatting(),e)]),this.selection}}rebuildList(t,e,i,s){let n=[],r=this.selection.start,o=this.selection.end;const l=this.words[i].isNewLine()||"listEnd"==b(this.words[i])?1:0;if("listNext"==b(this.words[e])){this.range(t.start,t.start).getListStyle()!=(s.marker||"number")?(n=n.concat(y({$:"listEnd"})),n=n.concat(y(s)),r++,o++):n.push(this.words[e])}else"listStart"==b(this.words[e])?n=n.concat(y(s)):(0==e?(n=n.concat(y(s)),this.words.length>1&&n.push(this.words[e])):(n.push(this.words[e]),n=n.concat(y(s))),r++,o++);for(let t=e+1;t<i;t++){const e=this.words[t];"listEnd"==b(e)&&t!=i-1||e.isNewLine()?n=n.concat(y({$:"listNext"})):n.push(e);const s=this.words[t+1];("listEnd"==b(e)&&s.isNewLine()||e.isNewLine()&&"listStart"==b(s)||"listEnd"==b(e)&&"listStart"==b(s))&&(t++,this.wordOrdinal(t)<r&&r--,this.wordOrdinal(t)<o&&o--)}return n=n.concat(y({$:"listEnd"})),this.spliceWords(e,i-e+l,n),{start:r,end:o}}}e.default=x},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.part=e.Part=void 0;const s=i(2),n=i(2),r=i(4);class o{constructor(){this.name="inline"}measure(t){const e=s.measure("?",t);return new n.Measure(e.width+4,e.width+2,e.width+2)}draw(t,e,i,s,n,r){t.fillStyle="silver",t.fillRect(e,i-n,s,n+r),t.strokeRect(e,i-n,s,n+r),t.fillStyle="black",t.fillText("?",e+2,i)}}class l{constructor(t,e,i,s){this.run=t,this.isNewLine=e,this.width=e?0:i.width,this.ascent=i.ascent,this.descent=i.descent,this.code=s}draw(t,e,i){"string"==typeof this.run.text?s.draw(t,this.run.text,this.run,e,i,this.width,this.ascent,this.descent):this.code&&this.code.draw&&(t.save(),this.code.draw(t,e,i,this.width,this.ascent,this.descent,this.run),t.restore())}}e.Part=l,e.part=function(t){let e,i,h;return"string"==typeof t.text?(i=1===t.text.length&&"\n"===t.text[0],e=s.measure(i?s.nbsp:t.text,t)):(h=r.default(t.text)||new o,e=h.measure?h.measure(t):new n.Measure(0,0,0)),new l(t,i,e,h)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(3),n=i(1),r=i(18);class o extends s.default{constructor(t,e,i,s,n,o,l,h){super("frame"),this.ordinal=n,this._parent=o,this.lines=[];const a=r.default(t,e,i,s,n,this,l,h);for(const t of a)"number"==typeof t?this.height=t:(this.length=t.ordinal+t.length-n,this.lines.push(t))}bounds(){if(!this._bounds){let t=0,e=0,i=0,s=0;if(this.lines.length){const n=this.lines[0].bounds();t=n.l,e=n.t,this.lines.forEach(t=>{const e=t.bounds();i=Math.max(i,e.l+e.w),s=Math.max(s,e.t+e.h)})}this._bounds=new n.default(t,e,i-t,this.height||s-e)}return this._bounds}actualWidth(){if(!this._actualWidth){let t=0;this.lines.forEach(e=>{"number"==typeof e.actualWidth&&(t=Math.max(t,e.actualWidth))}),this._actualWidth=t}return this._actualWidth}children(){return this.lines}parent(){return this._parent}draw(t,e){const i=e?e.t:0,s=e?e.t+e.h:Number.MAX_VALUE;this.lines.some(n=>{const r=n.bounds();return!(r.t+r.h<i)&&(r.t>s||void n.draw(t,e))})}}e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PositionedWord=void 0;const s=i(1),n=i(7),r=i(3),o=i(2),l=i(10);class h extends r.default{constructor(t,e,i,s,n){super("word"),this.word=t,this.line=e,this.left=i,this.ordinal=s,this.width=n,this.length=t.text.length+t.space.length}draw(t){this.word.draw(t,this.line.left+this.left,this.line.baseline)}bounds(){return new s.default(this.line.left+this.left,this.line.baseline-this.line.ascent,this.word.isNewLine()?o.newLineWidth:this.width,this.line.ascent+this.line.descent)}*parts(){yield*this.word.text.parts,yield*this.word.space.parts}realiseCharacters(){if(!this._characters){const t=[];let e=0,i=this.ordinal;for(const s of this.parts()){const r=r=>{const o=Object.assign({},s.run);o.text=r;const h=n.part(o);t.push(new l.default(e,h,this,i,1)),e+=h.width,i++},o=s.run.text;if("string"==typeof o)for(const t of o)r(t);else r(o)}const s=t[t.length-1];s&&(s.width=this.width-s.left,(this.word.isNewLine()||this.word.code()&&this.word.code().eof)&&(s.newLine=!0)),this._characters=t}}children(){return this.realiseCharacters(),this._characters}parent(){return this.line}}e.PositionedWord=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(3),n=i(2),r=i(1);class o extends s.default{constructor(t,e,i,s,n){super("character"),this.left=t,this.part=e,this.word=i,this.ordinal=s,this.length=n}bounds(){const t=this.word.bounds(),e=this.word.word.isNewLine()?n.newLineWidth:this.width||this.part.width;return new r.default(t.l+this.left,t.t,e,t.h)}parent(){return this.word}byOrdinal(){return this}byCoordinate(t,e){return t<=this.bounds().center().x?this:this.next()}}e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);class n{constructor(t,e,i){this.text=t,this.space=e,this.softWrap=i,this.ascent=Math.max(t.ascent,e.ascent),this.descent=Math.max(t.descent,e.descent),this.width=t.width+e.width,this.length=t.length+e.length}isNewLine(){return 1===this.text.parts.length&&this.text.parts[0].isNewLine}code(){return 1===this.text.parts.length&&this.text.parts[0].code}startFormatting(){return this.text.parts.length>0?n.cleanupUrl(this.text.parts[0].run):this.space.parts.length>0?n.cleanupUrl(this.space.parts[0].run):void 0}endFormatting(){return this.space.parts.length>0?n.cleanupUrl(this.space.parts[this.space.parts.length-1].run):this.text.parts.length>0?n.cleanupUrl(this.text.parts[this.text.parts.length-1].run):void 0}static cleanupUrl(t){if(t.url){const e=s.clone(t);return delete e.url,delete e.color,delete e.underline,e}return t}draw(t,e,i){const s=s=>{s.draw(t,e,i),e+=s.width};this.text.parts.forEach(s),this.space.parts.forEach(s)}plainText(){return this.text.plainText+this.space.plainText}align(){const t=this.text.parts[0];return t?t.run.align:"left"}*runs(t){let e=t&&t.start||0,i=t&&t.end;void 0===i&&(i=Number.MAX_VALUE);for(const t of[this.text,this.space])for(const s of t.parts){if(e>=i||i<=0)return!0;const t=s.run,n=t.text;if("string"==typeof n){if(e<=0&&i>=n.length)yield t;else if(e<n.length){const s=Object.assign({},t),r=Math.max(0,e);s.text=n.substr(r,Math.min(n.length,i-r)),yield s}e-=n.length,i-=n.length}else e<=0&&i>=1&&(yield t),e--,i--}}}e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.default=class{constructor(t){this.parts=t,this.ascent=0,this.descent=0,this.width=0,this.length=0,this.plainText="";for(const e of t)this.ascent=Math.max(this.ascent,e.ascent),this.descent=Math.max(this.descent,e.descent),this.width+=e.width,this.length+=s.getPieceLength(e.run.text),this.plainText+=s.getPiecePlainText(e.run.text)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.gfilter=e.gfoldl=e.gmap=void 0,e.gmap=function*(t,e){for(const i of t)yield e(i)},e.gfoldl=function(t,e){let i=t.next().value;for(const s of t)i=e(i,s);return i},e.gfilter=function*(t,e){for(const i of t)e(i)&&(yield i)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const t=[],e=e=>{t.push(e)};return e.fire=(...e)=>{t.forEach(t=>{t(...e)})},e}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.bundle=void 0;const s=i(5),n=i(23),r=i(25),o=i(0),l=i(27),h=i(4),a=i(2);if(e.bundle={editor:s,table:n,mindmap:r,runs:o,html:l,codes:h,text:a},"undefined"!=typeof window&&window.document){if(window.murok)throw new Error("Something else is called murok!");window.murok=e.bundle}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.characters=e.Character=void 0;const s=i(0);class n{constructor(t,e,i){this._runs=t,this._run=e,this._offset=i,this.char=e>=t.length?null:s.getTextChar(t[e].text,i)}equals(t){return this._run===t._run&&this._offset===t._offset}*cut(t){for(let e=this._run;e<=t._run;e++){const i=this._runs[e];if(i){const n=e===this._run?this._offset:0,r=e===t._run?t._offset:s.getTextLength(i.text);if(n<r)for(const t of s.getSubText(i.text,n,r-n)){const e=Object.assign({},i);e.text=t,yield e}}}}}e.Character=n,e.characters=function*(t){for(let e=0;e<t.length;e++)for(let i=0;i<s.getTextLength(t[e].text);i++)yield new n(t,e,i);yield new n(t,t.length,0)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.split=void 0;const s=i(4),n=i(13),r=i(7),o=i(11),l=i(12);e.split=function*(t){let e,i=null,h=null,a=!0;for(const c of t){if(null===c.char)e=!0;else if(a&&(e=!0,a=!1),"string"==typeof c.char)switch(c.char){case" ":h||(h=c);break;case"\n":e=!0,a=!0;break;default:h&&(e=!0)}else{const t=s.default(c.char);(t.block||t.eof)&&(e=!0,a=!0)}if(e){if(i&&!i.equals(c)){const t=h||c,e=new l.default([...n.gmap(i.cut(t),r.part)]),s=new l.default([...n.gmap(t.cut(c),r.part)]);yield new o.default(e,s,!1),h=null}if(null===c.char)return;i=c,e=!1}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(19),n=i(11),r=i(7),o=i(12);e.default=function*(t,e,i,l,h,a,c,d){const u=[];let f,g=0,p=i,w=c||0,m=d||0;function y(t){if(u.push(t),g+=t.width,w=Math.max(w,t.ascent),m=Math.max(m,t.descent),t.isNewLine())return b()}function b(){const t=new s.default(a,e,l,p+w,w,m,u,h);return h+=t.length,p+=w+m,u.length=0,w=m=g=0,t}function x(t,e,i){const s=[],l=[];for(const n of t.runs({start:e,end:i}))"string"==typeof n.text&&""===n.text.trim()?l.push(n):s.push(n);return new n.default(new o.default(s.map(r.part)),new o.default(l.map(r.part)),!0)}for(const i of t)if(f){const t=f(i);t&&(f=null,h+=t.length,p+=t.bounds().h,t.block=!0,yield t)}else{const t=i.code();if(t&&t.block)u.length&&(yield b()),f=t.block(e,p,l,h,a,i.startFormatting());else if(i.width>l){u.length&&(yield b());let t=0,e=0;for(;e<=i.length;){const s=[...i.runs({start:t,end:e})];new o.default(s.map(r.part)).width>l&&(y(x(i,t,e-1)),yield b(),t=e-1),e++}t!=i.length&&y(x(i,t,i.length))}else if(u.length){g+i.text.width>l&&(yield b());const t=y(i);t&&(yield t)}else{const t=y(i);t&&(yield t)}}0==t.length&&(yield b()),u.length&&(yield b()),yield p-i}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(9),n=i(1),r=i(3);class o extends r.default{constructor(t,e,i,n,r,o,l,h){super("line"),this.doc=t,this.left=e,this.width=i,this.baseline=n,this.ascent=r,this.descent=o,this.ordinal=h,this.actualWidth=0,this.length=0,l.length>0&&(this.align=l[0].align(),l.forEach(t=>{this.actualWidth+=t.width}),this.actualWidth-=l[l.length-1].space.width);let a=0,c=0;if(this.actualWidth<i)switch(this.align){case"right":a=i-this.actualWidth;break;case"center":a=(i-this.actualWidth)/2;break;case"justify":l.length>1&&!l[l.length-1].isNewLine()&&(c=(i-this.actualWidth)/(l.length-1))}this.positionedWords=l.map(t=>{const e=a;a+=t.width+c;const i=h;return h+=t.length,new s.PositionedWord(t,this,e,i,t.width+c)}),this.length=h-this.ordinal}bounds(t){if(t&&this.positionedWords.length>0){const t=this.first().bounds(),e=this.last().bounds();return new n.default(t.l,this.baseline-this.ascent,e.l+e.w-t.l,this.ascent+this.descent)}return new n.default(this.left,this.baseline-this.ascent,this.width,this.ascent+this.descent)}parent(){return this.doc}children(){return this.positionedWords}}e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(3),n=i(1);class r extends s.default{constructor(t,e,i,s,n){super("inline"),this.inline=t,this._parent=e,this.ordinal=i,this.length=s,this.formatting=n,this.measured=t.measure(n)}parent(){return this._parent}draw(t){this.inline.draw(t,this.left,this.baseline,this.measured.width,this.measured.ascent,this.measured.descent,this.formatting)}position(t,e,i){this.left=t,this.baseline=e,i&&(this._bounds=i)}bounds(){return this._bounds||new n.default(this.left,this.baseline-this.measured.ascent,this.measured.width,this.measured.ascent+this.measured.descent)}byCoordinate(t,e){return t<=this.bounds().center().x?this:this.next()}}e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(3);class n extends s.default{constructor(t,e,i,s){super(t),this._children=[],this._parent=e,this._left="number"==typeof i?i:Number.MAX_VALUE,this._top="number"==typeof s?s:Number.MAX_VALUE}children(){return this._children}parent(){return this._parent}finalize(t,e){let i=Number.MAX_VALUE,s=0;this._children.forEach(t=>{i=Math.min(i,t.ordinal),s=Math.max(s,t.ordinal+t.length)}),this.ordinal=i-(t||0),this.length=(e||0)+s-i}}e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Range=void 0;const s=i(0),n=i(13),r=i(0);e.Range=class{constructor(t,e,i){this.doc=t,this.start=e,this.end=i,e>i&&(this.start=i,this.end=e)}*parts(t){t=t||this.doc.children();for(const e of t)if(!(e.ordinal+e.length<=this.start)){if(e.ordinal>=this.end)break;e.ordinal>=this.start&&e.ordinal+e.length<=this.end?yield e:yield*this.parts(e.children())}}clear(){return this.setText([])}setText(t){return this.doc.splice(this.start,this.end,t)}plainText(){return[...n.gmap(this.doc.runs(this),s.getPlainText)].join("")}save(){return[...s.consolidate([...this.doc.runs(this)])]}getFormatting(){if(this.start===this.end){let t=this.start;t>0&&t--,this.start=t,this.end=t+1}const t=n.gfoldl(this.doc.runs(this),s.merge)||r.defaultFormatting;return Object.keys(r.defaultFormatting).forEach(e=>{e in t||(t[e]=r.defaultFormatting[e])}),t}getFormattingValue(t,e){const i=this.getFormatting();return i[t]===s.multipleValues?e:i[t]}setFormatting(t,e){if("align"===t){this.doc.paragraphRange(this.start,this.end).setOwnFormatting(t,e)}else this.setOwnFormatting(t,e)}setOwnFormatting(t,e){if(this.start===this.end)this.doc.modifyInsertFormatting(t,e);else{const i=this.save(),n={};n[t]=e,s.format(i,n),this.setText(i)}}getListStyle(){const t=this.doc.wordContainingOrdinal(this.start),e=this.doc.wordContainingOrdinal(this.end);if(t&&e){for(let i=e.index-1;i>=0;i--){const e=this.doc.words[i].code(),s=e&&e.name;if("listStart"===s){if(i<=t.index)return e.type||"number";break}if("listEnd"===s)break}}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.create=void 0;const s=i(24);e.create=function(t){t.style.position="absolute";const e=document.createElement("canvas"),i=document.createElement("div");i.style.position="absolute",i.style.visibility="hidden",t.append(e,i);const n=new s.default;return n.addToDom(e,i),n}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(5),n=i(6),r=i(1),o=i(14),l=i(0),h=i(2);class a{constructor(){this.contentChanged=o.default(),this.sizeChanged=o.default(),this.selectionChanged=o.default(),this.renderer=new n.default}load(t){this.rows=t.rows.length,this.cols=t.columns.length,this.rowHeights=t.rows,this.colWidths=t.columns,this.recalculateCumulativeWidths(),this.recalculateCumulativeHeights(),this.totalHeight=this.cumulativeHeights[this.rows],this.totalWidth=this.cumulativeWidths[this.cols],this.bgcolor=t.bgcolor,this.content=t.content}save(){return this.saveEditorState(),{rows:this.rowHeights,columns:this.colWidths,bgcolor:this.bgcolor,content:this.content}}init(t,e,i){this.rows=t,this.cols=e,this.totalHeight=t*a.DEFAULT_CELL_HEIGHT,this.totalWidth=e*a.DEFAULT_CELL_WIDTH,this.rowHeights=new Array(e).fill(a.DEFAULT_CELL_HEIGHT),this.colWidths=new Array(t).fill(a.DEFAULT_CELL_WIDTH),this.recalculateCumulativeHeights(),this.recalculateCumulativeWidths(),this.content=[];for(let s=0;s<t;s++){this.content[s]=[];for(let t=0;t<e;t++)this.content[s][t]={content:i&&i[s]&&i[s][t]}}}startEditing(t,e,i){const s=this.editorElement.style;(t=t||{col0:0,row0:0}).editing=!0,this.selection=t,s.visibility="visible",s.left=this.cumulativeWidths[t.col0]+a.THRESHOLD+"px",s.top=this.cumulativeHeights[t.row0]+a.THRESHOLD+"px",s.width=this.colWidths[t.col0]-2*a.THRESHOLD+"px",s.height=this.rowHeights[t.row0]-2*a.THRESHOLD+"px",this.editor.load(this.content[t.row0][t.col0].content||[]);const n=e-this.cumulativeWidths[t.col0],r=i-this.cumulativeHeights[t.row0],o=this.editor.byCoordinate(n,r).ordinal;this.editor.select(o,o,!0),this.repaint()}saveEditorState(){if(this.selection&&this.selection.editing){const{col0:t,row0:e}=this.selection,i=this.editor.save();a.isSame(this.content[e][t].content,i)||(i.length>0?this.content[e][t].content=i:delete this.content[e][t].content)}}static isSame(t,e){if(null==t)return 0==e.length||1==e.length&&"\n"==e[0].text;if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){if(t[i].text!=e[i].text)return!1;if(!l.sameFormatting(t[i],e[i]))return!1}return!0}stopEditing(){this.selection&&this.selection.editing&&(this.saveEditorState(),this.selection.editing=!1,this.editorElement.style.visibility="hidden")}removeSelection(){this.stopEditing(),this.selection=null,this.repaint()}getHitCell(t,e){for(let i=0;i<this.rows;i++)for(let s=0;s<this.cols;s++)if(this.cumulativeWidths[s]<=t&&t<this.cumulativeWidths[s+1]&&this.cumulativeHeights[i]<=e&&e<this.cumulativeHeights[i+1])return{col0:s,row0:i}}repaint(){if(this.canvas){const t=this.canvas.getContext("2d");this.canvas.width=this.totalWidth+1,this.canvas.height=this.totalHeight+1,t.clearRect(0,0,this.totalWidth+1,this.totalHeight+1),this.draw(t)}}addToDom(t,e){this.canvas=t,this.editorElement=e,this.editor=s.create(e),this.editor.selectionChanged(this.selectionChanged.fire),this.editor.contentChanged(this.contentChanged.fire);const i=(e,i)=>{for(let e=1;e<this.rows;e++)if(Math.abs(i-this.cumulativeHeights[e])<a.THRESHOLD)return t.style.cursor="ns-resize",this.xResizeHovering=null,this.yResizeHovering=e,!0;for(let i=1;i<this.cols;i++)if(Math.abs(e-this.cumulativeWidths[i])<a.THRESHOLD)return t.style.cursor="ew-resize",this.xResizeHovering=i,this.yResizeHovering=null,!0;return!1},n=(t,e,i)=>{const s=e-this.cumulativeWidths[t.col0],n=i-this.cumulativeHeights[t.row0];return s>a.THRESHOLD||s<this.colWidths[t.col0]-a.THRESHOLD||n>a.THRESHOLD||n<this.rowHeights[t.row0]-a.THRESHOLD},r=e.querySelector("canvas"),o=t=>{const e=t.offsetX,i=t.offsetY,s=this.getHitCell(e,i);if(s&&n(s,e,i)&&this.isEditing(s.col0,s.row0)){const e=new PointerEvent(t.type,{clientX:t.clientX,clientY:t.clientY});return r.dispatchEvent(e),!0}};let l;t.addEventListener("pointerdown",t=>{if(o(t))return;this.removeSelection();const e=t.offsetX,s=t.offsetY;if(i(e,s))return;const r=this.getHitCell(e,s);n(r,e,s)?(l=this.selection=r,this.repaint()):l=this.selection=null}),t.addEventListener("pointermove",e=>{if(o(e))return;const s=e.offsetX,n=e.offsetY;if(1!=e.buttons)i(s,n)||(t.style.cursor="default",this.xResizeHovering=this.yResizeHovering=null);else{if(this.yResizeHovering){const t=this.yResizeHovering;this.resizePosition=a.clamp(n,this.cumulativeHeights[t-1]+a.MIN_CELL_SIZE,this.cumulativeHeights[t+1]-a.MIN_CELL_SIZE)}if(this.xResizeHovering){const t=this.xResizeHovering;this.resizePosition=a.clamp(s,this.cumulativeWidths[t-1]+a.MIN_CELL_SIZE,this.cumulativeWidths[t+1]-a.MIN_CELL_SIZE)}const t=this.getHitCell(s,n);if(this.selection&&t){const{col0:e,row0:i}=l,{col0:s,row0:n}=t;(this.selection.col1||e!=s||i!=n)&&(this.stopEditing(),this.selection={col0:Math.min(e,s),row0:Math.min(i,n),col1:Math.max(e,s)+1,row1:Math.max(i,n)+1})}this.repaint()}}),window.addEventListener("pointerup",t=>{o(t)||(this.resizePosition&&(this.yResizeHovering&&(this.resizeY(this.yResizeHovering,this.resizePosition),this.resizePosition=null,this.repaint()),this.xResizeHovering&&(this.resizeX(this.xResizeHovering,this.resizePosition),this.resizePosition=null,this.repaint())),this.xResizeHovering=this.yResizeHovering=null,!this.selection||this.selection.col1||this.selection.row1||(this.startEditing(this.selection,t.offsetX,t.offsetY),t.preventDefault()))});e.querySelector("textarea").addEventListener("focusout",this.saveEditorState.bind(this)),r.addEventListener("pointerdown",e=>{e.pointerId&&t.setPointerCapture(e.pointerId)}),this.contentChanged(this.repaint.bind(this)),this.sizeChanged(this.repaint.bind(this))}draw(t){t.save(),this.paintBackground(t);for(let e=0;e<this.rows;e++){const i=this.rowHeights[e];for(let s=0;s<this.cols;s++){if(this.isEditing(s,e))continue;const n=this.colWidths[s],o=this.content[e][s];t.translate(this.cumulativeWidths[s]+a.THRESHOLD,this.cumulativeHeights[e]+a.THRESHOLD),t.save(),t.beginPath(),t.rect(0,0,n-2*a.THRESHOLD,i-2*a.THRESHOLD),t.clip(),this.renderer.load(o.content||[]),this.renderer.setWidth(n-2*a.THRESHOLD),this.renderer.draw(t,new r.default(0,0,n,i)),t.restore(),t.translate(-this.cumulativeWidths[s]-a.THRESHOLD,-this.cumulativeHeights[e]-a.THRESHOLD)}}t.fillStyle="#000000DD",t.strokeStyle="#000000DD";for(let e=0;e<=this.rows;e++)t.fillRect(0,this.cumulativeHeights[e],this.totalWidth,1);for(let e=0;e<=this.cols;e++)t.fillRect(Math.max(this.cumulativeWidths[e]-1,0),0,1,this.totalHeight);if(this.selection){t.lineWidth=2;const{col0:e,row0:i,col1:s,row1:n}=this.selection;if(s||n){t.fillStyle=h.selectionColor;const r=this.cumulativeWidths[e],o=this.cumulativeHeights[i],l=this.cumulativeWidths[s]-r,a=this.cumulativeHeights[n]-o;t.fillRect(r,o,l,a)}else t.strokeRect(this.cumulativeWidths[e],this.cumulativeHeights[i],this.colWidths[e],this.rowHeights[i])}this.resizePosition&&(this.xResizeHovering&&(t.fillStyle="#003366DD",t.fillRect(this.resizePosition,0,3,this.totalHeight)),this.yResizeHovering&&(t.fillStyle="#003366DD",t.fillRect(0,this.resizePosition,this.totalWidth,3))),t.restore()}paintBackground(t){this.bgcolor&&(t.fillStyle=this.bgcolor,t.fillRect(0,0,this.totalWidth,this.totalHeight));for(let e=0;e<this.rows;e++){const i=this.cumulativeHeights[e],s=this.rowHeights[e];for(let n=0;n<this.cols;n++){const r=this.cumulativeWidths[n],o=this.colWidths[n],l=this.content[e][n].bgcolor;"transparent"==l?t.clearRect(r,i,o,s):l&&(t.fillStyle=l,t.fillRect(r,i,o,s))}}}isEditing(t,e){return this.selection&&this.selection.editing&&this.selection.col0==t&&this.selection.row0==e}getListStyle(){return this.editor.selectedRange().getListStyle()}switchListTo(t){this.editor.switchListTo(this.editor.selectedRange(),t)}hyperlinkRange(){return this.editor.hyperlinkRange()}selectedRange(){return this.editor.selectedRange()}insert(t){this.editor.insert(t)}insertHyperlink(t,e){this.editor.insertHyperlink(t,e)}setHyperlinkUrl(t){this.editor.setHyperlinkUrl(t)}urlByCoordinate(t,e){const i=this.getHitCell(t,e);return this.renderer.load(this.content[i.row0][i.col0].content||[]),this.renderer.urlByCoordinate(t-this.cumulativeWidths[i.col0]-a.THRESHOLD,e-this.cumulativeHeights[i.row0]-a.THRESHOLD)}setFormatting(t,e){if(this.selection&&this.selection.editing){const i=this.editor.selectedRange();i.start==i.end?this.editor.documentRange().setFormatting(t,e):this.editor.selectedRange().setFormatting(t,e)}else{const{col0:i,row0:s,col1:n,row1:r}=this.getRange();for(let o=s;o<(r||s+1);o++)for(let s=i;s<(n||i+1);s++)this.content[o][s].content&&0!=this.content[o][s].content.length&&(this.renderer.load(this.content[o][s].content),this.renderer.documentRange().setFormatting(t,e),this.content[o][s].content=this.renderer.save())}this.repaint()}setBackgroundColor(t){if(this.selection){const{col0:e,row0:i,col1:s,row1:n}=this.getRange();for(let r=i;r<(n||i+1);r++)for(let i=e;i<(s||e+1);i++){const e=this.content[r][i];this.bgcolor==t?delete e.bgcolor:e.bgcolor=t||"transparent"}}else{for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++)delete this.content[t][e].bgcolor;null==t?delete this.bgcolor:this.bgcolor=t}this.contentChanged.fire()}getFormatting(t,e){let i;if(this.selection&&this.selection.editing)i=this.editor.selectedRange().getFormatting();else{const{col0:t,row0:e,col1:s,row1:n}=this.getRange();for(let r=e;r<(n||e+1);r++)for(let e=t;e<(s||t+1);e++){const t=this.content[r][e].content;if(!t||0==t.length)continue;this.renderer.load(t);const s=this.renderer.documentRange().getFormatting();i=i?l.merge(s,i):s}}const s=(i||l.defaultFormatting)[t];return t?l.isMultipleValues(s)?e:s:l.defaultFormatting[t]}getRange(){return this.selection||{col0:0,row0:0,col1:this.cols,row1:this.rows}}static clamp(t,e,i){return t<=e?e:t>=i?i:t}resizeY(t,e){this.cumulativeHeights[t]=e,this.rowHeights[t-1]=e-this.cumulativeHeights[t-1],this.rowHeights[t]=this.cumulativeHeights[t+1]-e,this.contentChanged.fire()}resizeX(t,e){this.cumulativeWidths[t]=e,this.colWidths[t-1]=e-this.cumulativeWidths[t-1],this.colWidths[t]=this.cumulativeWidths[t+1]-e,this.contentChanged.fire()}setWidth(t){t!=this.totalWidth&&(this.colWidths=a.resize(this.totalWidth,t,this.getMinWidth(),this.colWidths),this.totalWidth=t,this.recalculateCumulativeWidths(),this.sizeChanged.fire())}setHeight(t){t!=this.totalHeight&&(this.rowHeights=a.resize(this.totalHeight,t,this.getMinHeight(),this.rowHeights),this.totalHeight=t,this.recalculateCumulativeHeights(),this.sizeChanged.fire())}static resize(t,e,i,s){const n=a.MIN_CELL_SIZE,r=e/t,o=s.every(t=>t*r>=n);let l=s.map(t=>Math.max(n,t*r));if(!o){const t=(e-i)/(s.reduce((t,e)=>t+e,0)-i);Number.isFinite(t)&&(l=l.map(e=>n+(e-n)*t))}return l[l.length-1]+=e-l.reduce((t,e)=>t+e),l}getMinWidth(){return a.MIN_CELL_SIZE*this.cols}getMinHeight(){return a.MIN_CELL_SIZE*this.rows}addRow(t){this.stopEditing(),this.totalHeight+=a.DEFAULT_CELL_HEIGHT,this.rows++,this.rowHeights.splice(t,0,a.DEFAULT_CELL_HEIGHT),this.recalculateCumulativeHeights(),this.content.splice(t,0,Array.from({length:this.cols},()=>({}))),this.contentChanged.fire()}addColumn(t){this.stopEditing(),this.totalWidth+=a.DEFAULT_CELL_WIDTH,this.cols++,this.colWidths.splice(t,0,a.DEFAULT_CELL_WIDTH),this.recalculateCumulativeWidths(),this.content.forEach((e,i)=>e.splice(t,0,{})),this.contentChanged.fire()}removeRow(t){this.removeSelection(),this.totalHeight-=this.rowHeights[t],this.rows--,this.rowHeights.splice(t,1),this.recalculateCumulativeHeights(),this.content.splice(t,1),this.contentChanged.fire()}removeColumn(t){this.removeSelection(),this.totalWidth-=this.colWidths[t],this.cols--,this.colWidths.splice(t,1),this.recalculateCumulativeWidths(),this.content.forEach((e,i)=>e.splice(t,1)),this.contentChanged.fire()}recalculateCumulativeHeights(){this.cumulativeHeights=new Array(this.rows+1),this.cumulativeHeights[0]=0;for(let t=1;t<=this.rows;t++)this.cumulativeHeights[t]=this.cumulativeHeights[t-1]+this.rowHeights[t-1]}recalculateCumulativeWidths(){this.cumulativeWidths=new Array(this.cols+1),this.cumulativeWidths[0]=0;for(let t=1;t<=this.cols;t++)this.cumulativeWidths[t]=this.cumulativeWidths[t-1]+this.colWidths[t-1]}get selection(){return this._selection}set selection(t){this._selection=t,this.selectionChanged.fire()}}e.default=a,a.DEFAULT_CELL_HEIGHT=36,a.DEFAULT_CELL_WIDTH=100,a.MIN_CELL_SIZE=16,a.THRESHOLD=6},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.create=void 0;const s=i(26);e.create=function(t){t.style.position="absolute";const e=document.createElement("canvas"),i=document.createElement("div");i.style.position="absolute",i.style.visibility="hidden",t.append(e,i);const n=new s.default;return n.addToDom(e,i),n}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(5),n=i(6),r=i(1);class o{constructor(){this.renderer=new n.default}addToDom(t,e){this.canvas=t,this.editorElement=e,this.editor=s.create(e),t.setAttribute("tabindex","0"),t.addEventListener("keypress",t=>{"n"==t.key&&this.selected&&o.addChild(this.selected,{txtdata:[],x:this.selected.x,y:this.selected.y-100,width:o.DEFAULT_NODE_WIDTH,height:o.DEFAULT_NODE_HEIGHT}),this.repaint()}),t.addEventListener("pointerdown",t=>{const e=o.getHitNode(this.root,t.offsetX,t.offsetY);e&&e==this.selected?this.startEditing(e,t.offsetX,t.offsetY):this.editing&&this.stopEditing(),this.selected=e,this.repaint()}),t.addEventListener("pointermove",t=>{1==t.buttons&&this.selected&&this.selected==o.getHitNode(this.root,t.offsetX,t.offsetY)&&(this.selected.x+=t.movementX,this.selected.y+=t.movementY,this.repaint())})}saveEditorState(){const t=this.editor.save();t.length>0?this.selected.txtdata=t:delete this.selected.txtdata}stopEditing(){this.selected&&this.editing&&(this.saveEditorState(),this.editing=!1,this.editorElement.style.visibility="hidden")}static addChild(t,e){t.children?t.children.push(e):t.children=[e]}startEditing(t,e,i){const s=this.editorElement.style;this.editing=!0,s.visibility="visible",s.left=t.x+o.PADDING+"px",s.top=t.y+o.PADDING+"px",s.width=t.width-2*o.PADDING+"px",s.height=t.height-2*o.PADDING+"px",this.editor.load(t.txtdata);const n=e-t.x-o.PADDING,r=i-t.y-o.PADDING,l=this.editor.byCoordinate(n,r).ordinal;this.editor.select(l,l,!0),this.repaint()}static getHitNode(t,e,i){if(t.x<e&&e<t.x+t.width&&t.y<i&&i<t.y+t.height)return t;if(t.children)for(const s of t.children){const t=o.getHitNode(s,e,i);if(t)return t}}init(t,e){this.width=t,this.height=e,this.root={txtdata:[],x:(t-o.DEFAULT_NODE_WIDTH)/2,y:(e-o.DEFAULT_NODE_HEIGHT)/2,width:o.DEFAULT_NODE_WIDTH,height:o.DEFAULT_NODE_HEIGHT},this.repaint()}repaint(){if(this.canvas){const t=this.canvas.getContext("2d");this.canvas.width=this.width,this.canvas.height=this.height,t.clearRect(0,0,this.width,this.height),this.draw(t)}}draw(t){o.drawSkeleton(t,this.root),this.drawContent(t,this.root)}static drawSkeleton(t,e){if(e.children)for(const i of e.children)t.beginPath(),t.moveTo(e.x+e.width/2,e.y+e.height/2),t.lineTo(i.x+i.width/2,i.y+i.height/2),t.stroke(),o.drawSkeleton(t,i)}drawContent(t,e){if(t.translate(e.x,e.y),t.clearRect(0,0,e.width,e.height),e==this.selected&&t.strokeRect(-1,-1,e.width+2,e.height+2),t.strokeRect(0,0,e.width,e.height),this.editing&&this.selected==e||(t.translate(o.PADDING,o.PADDING),t.save(),t.beginPath(),t.rect(0,0,e.width-2*o.PADDING,e.height-2*o.PADDING),t.clip(),this.renderer.load(e.txtdata),this.renderer.setWidth(e.width-2*o.PADDING),this.renderer.draw(t,new r.default(0,0,e.width,e.height)),t.restore(),t.translate(-o.PADDING,-o.PADDING)),t.translate(-e.x,-e.y),e.children)for(const i of e.children)this.drawContent(t,i)}}e.default=o,o.DEFAULT_NODE_WIDTH=100,o.DEFAULT_NODE_HEIGHT=40,o.PADDING=6},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parse=void 0;const s=i(0);function n(t,e){return(i,s)=>{i.nodeName===t&&(s[e]=!0)}}function r(t,e,i){return(s,n)=>{s.style&&s.style.getPropertyValue(t)===e&&(n[i]=!0)}}const o=["BR","P","H1","H2","H3","H4","H5"],l=["left","center","right","justify"];const h=(new Map).set("H1",30).set("H2",20).set("H3",16).set("H4",14).set("H5",12);const a=[n("B","bold"),n("STRONG","bold"),n("I","italic"),n("EM","italic"),n("U","underline"),n("S","strikeout"),n("STRIKE","strikeout"),n("DEL","strikeout"),r("fontWeight","bold","bold"),r("fontStyle","italic","italic"),r("textDecoration","underline","underline"),r("textDecoration","line-through","strikeout"),function(t,e){const i=t.style&&t.style.color;i&&(e.color=i)},function(t,e){const i=t.style&&t.style.fontFamily;i&&(e.font=function(t){const e=t.split(/\s*,\s*/g);if(0==e.length)return t;let i=(t=e[0]).match(/^"(.*)"$/);return i?i[1].trim():(i=t.match(/^'(.*)'$/),i?i[1].trim():t)}(i))},function(t,e){const i=t.style&&t.style.fontSize;if(i){const t=i.match(/^([\d.]+)pt$/);e.size=t?parseFloat(t[1]):10}},function(t,e){const i=t.style&&t.style.textAlign;var s;i&&(e.align=(s=i,l.includes(s)?s:"left"))},function(t,e){"SUB"===t.nodeName&&(e.script="sub")},function(t,e){"SUPER"===t.nodeName&&(e.script="super")},function(t,e){"CODE"===t.nodeName&&(e.font="monospace")},function(t,e){const i=h.get(t.nodeName);i&&(e.size=i)}];e.parse=function(t,e){let i;"string"==typeof t?(i=document.createElement("div"),i.innerHTML=t):i=t;let n=!0;const r=[],l=(t,e)=>{r.push(s.cloneWith(e,t))},h=(t,i)=>{if(t instanceof HTMLElement){if(i=Object.assign({},i),t.classList.forEach(t=>{const s=e.get(t);s&&Object.keys(s).forEach(t=>{i[t]=s[t]})}),a.forEach(e=>{e(t,i)}),t.childNodes)for(let e=0;e<t.childNodes.length;e++)h(t.childNodes[e],i);o.includes(t.nodeName)&&(l("\n",i),n=!0)}else((t,e)=>{let i=(t=t.replace(/\n+\s*/g," ")).length;t=t.replace(/^\s+/,""),n?n=!1:i!==t.length&&(t=" "+t),i=t.length,i!==(t=t.replace(/\s+$/,"")).length&&(n=!0,t+=" "),l(t,e)})(t.nodeValue,i)};return h(i,{}),[...s.consolidate(r)]}}]);